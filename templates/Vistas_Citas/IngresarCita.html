{% extends 'index_master.html' %}

{% block content %} 
<div class="container-fluid">
    <form>
    <div class="row">
        <div class="col-md-1"></div>
      <div class="col-8 mb-3">
        <h2>Agenda</h2>
      </div>
  </div>

<div class="container-fluid">
    <div class="row">
      <div class="col-md-3">
        <div class="sticky-top mb-3">
          <div class="card">
            <div class="card-header">
              <h4 class="card-title">Eventos</h4>
            </div>
            <div class="card-body">
              <!-- the events -->
              <div id="external-events">
                
                <div class="col internal-event bg-success">
                    <a href="{% url 'NuevaCita' %}" class="btn btn-success"><i class="nav-icon fas fa-plus"></i>&nbsp;&nbsp;Cita Nueva</a>
                  </div>
                <div class="checkbox">
                  <label for="drop-remove">
                    <input type="checkbox" id="drop-remove">
                    remove after drop
                  </label>
                </div>
              </div>
            </div>
            <!-- /.card-body -->
          </div>
          <!-- /.card -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Crear Evento</h3>
            </div>
            <div class="card-body">
              <div class="btn-group" style="width: 100%; margin-bottom: 10px;">
                <ul class="fc-color-picker" id="color-chooser">
                  <li><a class="text-primary" href="#"><i class="fas fa-square"></i></a></li>
                  <li><a class="text-warning" href="#"><i class="fas fa-square"></i></a></li>
                  <li><a class="text-success" href="#"><i class="fas fa-square"></i></a></li>
                  <li><a class="text-danger" href="#"><i class="fas fa-square"></i></a></li>
                  <li><a class="text-muted" href="#"><i class="fas fa-square"></i></a></li>
                </ul>
              </div>
              <!-- /btn-group -->
              <div class="input-group">
                <input id="new-event" type="text" class="form-control" placeholder="Titulo del evento">

                <div class="input-group-append">
                  <button id="add-new-event" type="button" class="btn btn-primary">Agregar</button>
                </div>
                <!-- /btn-group -->
              </div>
              <!-- /input-group -->
            </div>
          </div>
        </div>
      </div>
      <!-- /.col -->
      <div class="col-md-9">
        <div class="card card-primary">
          <div class="card-body p-0">
            <!-- THE CALENDAR -->
            <div id="calendar"></div>
          </div>
          <!-- /.card-body -->
        </div>
        <!-- /.card -->
      </div>
      <!-- /.col -->
    </div>
    <!-- /.row -->
  </div><!-- /.container-fluid -->

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      $(function () {
  
        /* inicializar los eventos externos
         -----------------------------------------------------------------*/
        function ini_events(ele) {
          ele.each(function () {
  
            // crear un objeto de evento (https://fullcalendar.io/docs/event-object)
            // no es necesario que tenga inicio o fin
            var eventObject = {
              title: $.trim($(this).text()) // utilizar el texto del elemento como título del evento
            }
  
            // almacenar el objeto de evento en el elemento DOM para acceder a él más tarde
            $(this).data('eventObject', eventObject)
  
            // hacer que el evento sea arrastrable utilizando jQuery UI
            $(this).draggable({
              zIndex        : 1070,
              revert        : true, // hará que el evento vuelva a su posición original después de arrastrarlo
              revertDuration: 0  
            })
  
          })
        }
  
        ini_events($('#external-events div.external-event'))
  
        /* inicializar el calendario
         -----------------------------------------------------------------*/
        // Fecha para los eventos del calendario (datos ficticios)
        var date = new Date()
        var d    = date.getDate(),
            m    = date.getMonth(),
            y    = date.getFullYear()
  
        var Calendar = FullCalendar.Calendar;
        var Draggable = FullCalendar.Draggable;
  
        var containerEl = document.getElementById('external-events');
        var checkbox = document.getElementById('drop-remove');
        var calendarEl = document.getElementById('calendar');
  
        // inicializar los eventos externos
        // -----------------------------------------------------------------
  
        new Draggable(containerEl, {
          itemSelector: '.external-event',
          eventData: function(eventEl) {
            return {
              title: eventEl.innerText,
              backgroundColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
              borderColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
              textColor: window.getComputedStyle( eventEl ,null).getPropertyValue('color'),
            };
          }
        });
  
        var calendar = new Calendar(calendarEl, {
          headerToolbar: {
            left  : 'prev,next today',
            center: 'title',
            right : 'dayGridMonth,timeGridWeek,timeGridDay'
          },
          locale: 'es', // Establecer el idioma en español
          themeSystem: 'bootstrap',
          // Eventos por defecto
          events: [
            {
              title          : 'Ernesto Pérez',
              start          : new Date(y, m, 1),
              backgroundColor: '#f56954', // rojo
              borderColor    : '#f56954', // rojo
              allDay         : false
            },
            {
              title          : 'Cerrado',
              start          : new Date(y, m, d - 5),
              end            : new Date(y, m, d - 2),
              backgroundColor: '#f39c12', // amarillo
              borderColor    : '#f39c12' // amarillo
            },
            {
                title          : 'Martina Mendoza',
                start          : new Date(y, m, 2),
                backgroundColor: '#f56954', // rojo
                borderColor    : '#f56954', // rojo
                allDay         : false
            },
            {
                title          : 'Pedro Martinez',
                start          : new Date(y, m, 1),
                backgroundColor: '#f56954', // rojo
                borderColor    : '#f56954', // rojo
                allDay         : false
            },
            {
              title          : 'Reunión',
              start          : new Date(y, m, d, 10, 30),
              allDay         : false,
              backgroundColor: '#0073b7', // azul
              borderColor    : '#0073b7' // azul
            },
            {
              title          : 'Almuerzo',
              start          : new Date(y, m, d, 12, 0),
              end            : new Date(y, m, d, 14, 0),
              allDay         : false,
              backgroundColor: '#00c0ef', // info (agua)
              borderColor    : '#00c0ef' // info (agua)
            },
            {
              title          : 'Fiesta de Cumpleaños',
              start          : new Date(y, m, d + 1, 19, 0),
              end            : new Date(y, m, d + 1, 22, 30),
              allDay         : false,
              backgroundColor: '#00a65a', // éxito (verde)
              borderColor    : '#00a65a' // éxito (verde)
            },
            {
              title          : 'Haz clic para ir a Google',
              start          : new Date(y, m, 28),
              end            : new Date(y, m, 29),
              url            : 'https://www.google.com/',
              backgroundColor: '#3c8dbc', // primario (azul claro)
              borderColor    : '#3c8dbc' // primario (azul claro)
            }
          ],
          editable  : true,
          droppable : true, // permite arrastrar elementos al calendario
          drop      : function(info) {
            // ¿está marcada la opción "eliminar después de arrastrar"?
            if (checkbox.checked) {
              // si es así, eliminar el elemento de la lista "Eventos arrastrables"
              info.draggedEl.parentNode.removeChild(info.draggedEl);
            }
          }
        });
  
        calendar.render();
  
        /* AÑADIR EVENTOS */
        var currColor = '#3c8dbc' // rojo por defecto
        // Selector de color
        $('#color-chooser > li > a').click(function (e) {
          e.preventDefault()
          // Guardar el color
          currColor = $(this).css('color')
          // Agregar efecto de color al botón
          $('#add-new-event').css({
            'background-color': currColor,
            'border-color'    : currColor
          })
        })
        $('#add-new-event').click(function (e) {
          e.preventDefault()
          // Obtener el valor y asegurarse de que no sea nulo
          var val = $('#new-event').val()
          if (val.length == 0) {
            return
          }
  
          // Crear eventos
          var event = $('<div />')
          event.css({
            'background-color': currColor,
            'border-color'    : currColor,
            'color'           : '#fff'
          }).addClass('external-event')
          event.text(val)
          $('#external-events').prepend(event)
  
          // Agregar funcionalidad de arrastrar
          ini_events(event)
  
          // Eliminar el evento del campo de entrada de texto
          $('#new-event').val('')
        })
      })
    });
  </script>
  
  
{% endblock %}